<!DOCTYPE html>
<html>
<head>
    <title>ProjectOplus_EGC-TR: Smart Dam Demo</title>
    <script src="https://cdn.plot.ly/plotly-3.1.0.min.js" charset="utf-8"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        textarea, input { width: 100%; max-width: 600px; }
        #results { white-space: pre-wrap; max-width: 600px; }
        #chart { max-width: 800px; }
    </style>
</head>
<body>
    <h1>Smart Dam: EGC + TR Demo</h1>
    <form id="optimize-form">
        <label>Input JSON (e.g., 100 drones):</label><br>
        <textarea id="input-json" rows="10">
{
    "entities": [{"id": "D1", "state": 5.0, "stable_states": [4.0, 8.0]}, {"id": "D2", "state": 10.0, "stable_states": [4.0, 8.0]}],
    "cycle_length": 12,
    "cycle_phases": 3,
    "target_state": 4.0,
    "noise_coefficient": 0.05
}
        </textarea><br>
        <button type="submit">Optimize</button>
    </form>
    <form id="natural-form">
        <label>Natural Language Query:</label><br>
        <input type="text" id="query" value="Balance my drones"><br>
        <button type="submit">Submit</button>
    </form>
    <div id="results"></div>
    <div id="chart"></div>
    <script>
        document.getElementById('optimize-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const input = JSON.parse(document.getElementById('input-json').value);
            const response = await fetch('/tr/optimize', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(input)
            });
            const data = await response.json();
            document.getElementById('results').innerText = JSON.stringify(data, null, 2);
            const visResponse = await fetch('/tr/visualize', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });
            const visData = await visResponse.json();
            Plotly.newPlot('chart', JSON.parse(visData.chart));
        });
        document.getElementById('natural-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const query = document.getElementById('query').value;
            const response = await fetch('/tr/natural', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({query})
            });
            const data = await response.json();
            document.getElementById('results').innerText = data.explanation;
        });
    </script>
</body>
</html>
